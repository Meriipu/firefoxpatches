From f93319eca3ef8586fb7f2a696aeb6d1c394db8c2 Mon Sep 17 00:00:00 2001
From: Meriipu <Meriipu@users.noreply.github.com>
Date: Fri, 17 Dec 2021 14:55:31 +0100
Subject: [PATCH 10/10] one-offs: display: none

---
 browser/base/content/browser.css                        | 8 ++++++++
 browser/components/urlbar/UrlbarInput.jsm               | 3 ++-
 browser/components/urlbar/UrlbarProviderTabToSearch.jsm | 4 ++++
 browser/components/urlbar/UrlbarSearchOneOffs.jsm       | 7 ++++++-
 browser/components/urlbar/UrlbarView.jsm                | 2 +-
 5 files changed, 21 insertions(+), 3 deletions(-)

diff --git a/browser/base/content/browser.css b/browser/base/content/browser.css
index 32b269d8d3c5..8315ef8fd457 100644
--- a/browser/base/content/browser.css
+++ b/browser/base/content/browser.css
@@ -95,6 +95,13 @@ body {
   display: none;
 }
 
+/* stop shitting up the urlbar */
+.search-one-offs
+{
+  display: none !important;
+}
+
+
 %ifdef MENUBAR_CAN_AUTOHIDE
 #toolbar-menubar[autohide="true"] {
   overflow: hidden;
@@ -1678,3 +1685,4 @@ toolbar[keyNav=true]:not([collapsed=true], [customizing=true]) toolbartabstop {
   margin-inline-start: 6px;
 }
 } /** END not Proton **/
+
diff --git a/browser/components/urlbar/UrlbarInput.jsm b/browser/components/urlbar/UrlbarInput.jsm
index 8460fbeee354..712cc8e8f06c 100644
--- a/browser/components/urlbar/UrlbarInput.jsm
+++ b/browser/components/urlbar/UrlbarInput.jsm
@@ -94,7 +94,8 @@ class UrlbarInput {
           <hbox class="search-one-offs"
                 compact="true"
                 includecurrentengine="true"
-                disabletab="true"/>
+                disabletab="true"
+                style="display: none !important;"/>
         </vbox>
       `)
     );
diff --git a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
index cd3e042942d8..2c83585a18f9 100644
--- a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
+++ b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
@@ -133,12 +133,16 @@ class ProviderTabToSearch extends UrlbarProvider {
    * @returns {boolean} Whether this provider should be invoked for the search.
    */
   async isActive(queryContext) {
+    return false;
+    // stop shitting up the urlbar
+    /*
     return (
       queryContext.searchString &&
       queryContext.tokens.length == 1 &&
       !queryContext.searchMode &&
       UrlbarPrefs.get("suggest.engines")
     );
+    */
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarSearchOneOffs.jsm b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
index 454f5a7ad1bc..5e4cd78a575c 100644
--- a/browser/components/urlbar/UrlbarSearchOneOffs.jsm
+++ b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
@@ -66,6 +66,8 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True to enable, false to disable.
    */
   enable(enable) {
+    // stop shitting up the urlbar
+    enable = false;
     if (enable) {
       this.telemetryOrigin = "urlbar";
       this.style.display = "";
@@ -101,10 +103,13 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True if the one-offs are connected to a view.
    */
   get hasView() {
+    // stop shitting up the urlbar
+    return false;
+
     // Return true if the one-offs are enabled.  We set style.display = "none"
     // when they're disabled, and we hide the container when there are no
     // engines to show.
-    return this.style.display != "none" && !this.container.hidden;
+    // return this.style.display != "none" && !this.container.hidden;
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarView.jsm b/browser/components/urlbar/UrlbarView.jsm
index 4711d492c7e3..8b6f56ea7fe7 100644
--- a/browser/components/urlbar/UrlbarView.jsm
+++ b/browser/components/urlbar/UrlbarView.jsm
@@ -609,7 +609,7 @@ class UrlbarView {
     let openPanelInstance = (this._openPanelInstance = {});
     this.oneOffSearchButtons.willHide().then(willHide => {
       if (!willHide && openPanelInstance == this._openPanelInstance) {
-        this.oneOffSearchButtons.enable(true);
+        this.oneOffSearchButtons.enable(false); // stop shitting up the urlbar
         this._openPanel();
       }
     });
-- 
2.34.1

