From 2b608ad4ea7b2bdaf8930c7014fe559e46228bbf Mon Sep 17 00:00:00 2001
From: Meriipu <Meriipu@users.noreply.github.com>
Date: Sat, 22 May 2021 17:15:22 +0200
Subject: [PATCH 10/10] one-offs: display: none

---
 browser/base/content/browser.css                        | 6 ++++++
 browser/components/urlbar/UrlbarInput.jsm               | 3 ++-
 browser/components/urlbar/UrlbarProviderTabToSearch.jsm | 4 ++++
 browser/components/urlbar/UrlbarSearchOneOffs.jsm       | 7 ++++++-
 browser/components/urlbar/UrlbarView.jsm                | 2 +-
 5 files changed, 19 insertions(+), 3 deletions(-)

diff --git a/browser/base/content/browser.css b/browser/base/content/browser.css
index 8130cd669b59..4851f2a755aa 100644
--- a/browser/base/content/browser.css
+++ b/browser/base/content/browser.css
@@ -1639,3 +1639,9 @@ toolbar[keyNav=true]:not([collapsed=true], [customizing=true]) toolbartabstop {
 #password-notification-password {
   margin-inline-start: 6px;
 }
+
+/* stop shitting up the urlbar */
+.search-one-offs
+{
+  display: none !important;
+}
diff --git a/browser/components/urlbar/UrlbarInput.jsm b/browser/components/urlbar/UrlbarInput.jsm
index 4fd2bd103a40..69e1d867e552 100644
--- a/browser/components/urlbar/UrlbarInput.jsm
+++ b/browser/components/urlbar/UrlbarInput.jsm
@@ -87,7 +87,8 @@ class UrlbarInput {
           <hbox class="search-one-offs"
                 compact="true"
                 includecurrentengine="true"
-                disabletab="true"/>
+                disabletab="true"
+                style="display: none !important;"/>
         </vbox>
       `)
     );
diff --git a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
index 78d4fb5a2233..c3dd0d1d4229 100644
--- a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
+++ b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
@@ -133,12 +133,16 @@ class ProviderTabToSearch extends UrlbarProvider {
    * @returns {boolean} Whether this provider should be invoked for the search.
    */
   async isActive(queryContext) {
+    return false;
+    // stop shitting up the urlbar
+    /*
     return (
       queryContext.searchString &&
       queryContext.tokens.length == 1 &&
       !queryContext.searchMode &&
       UrlbarPrefs.get("suggest.engines")
     );
+    */
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarSearchOneOffs.jsm b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
index 97f1541bbf32..bfb7f3ed0afe 100644
--- a/browser/components/urlbar/UrlbarSearchOneOffs.jsm
+++ b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
@@ -65,6 +65,8 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True to enable, false to disable.
    */
   enable(enable) {
+    // stop shitting up the urlbar
+    enable = false;
     if (enable) {
       this.telemetryOrigin = "urlbar";
       this.style.display = "";
@@ -100,10 +102,13 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True if the one-offs are connected to a view.
    */
   get hasView() {
+    // stop shitting up the urlbar
+    return false;
+
     // Return true if the one-offs are enabled.  We set style.display = "none"
     // when they're disabled, and we hide the container when there are no
     // engines to show.
-    return this.style.display != "none" && !this.container.hidden;
+    // return this.style.display != "none" && !this.container.hidden;
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarView.jsm b/browser/components/urlbar/UrlbarView.jsm
index efdee0d31376..271dca367677 100644
--- a/browser/components/urlbar/UrlbarView.jsm
+++ b/browser/components/urlbar/UrlbarView.jsm
@@ -607,7 +607,7 @@ class UrlbarView {
     let openPanelInstance = (this._openPanelInstance = {});
     this.oneOffSearchButtons.willHide().then(willHide => {
       if (!willHide && openPanelInstance == this._openPanelInstance) {
-        this.oneOffSearchButtons.enable(true);
+        this.oneOffSearchButtons.enable(false); // stop shitting up the urlbar
         this._openPanel();
       }
     });
-- 
2.31.1

