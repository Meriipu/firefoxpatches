From bbb594ff4da4ac230e79e3117660654dbcbf0de0 Mon Sep 17 00:00:00 2001
From: Meriipu <Meriipu@users.noreply.github.com>
Date: Fri, 17 Dec 2021 16:09:47 +0100
Subject: [PATCH 10/10] one-offs: display: none

---
 browser/base/content/browser.css                     | 12 ++++++++++++
 browser/components/urlbar/UrlbarInput.jsm            |  3 ++-
 .../components/urlbar/UrlbarProviderTabToSearch.jsm  |  4 ++++
 browser/components/urlbar/UrlbarSearchOneOffs.jsm    |  7 ++++++-
 browser/components/urlbar/UrlbarView.jsm             |  2 +-
 5 files changed, 25 insertions(+), 3 deletions(-)

diff --git a/browser/base/content/browser.css b/browser/base/content/browser.css
index 8d8abf5e8b59..229454751d18 100644
--- a/browser/base/content/browser.css
+++ b/browser/base/content/browser.css
@@ -94,6 +94,18 @@ body {
   }
 }
 
+.search-one-offs[compact=true] .search-setting-button,
+.search-one-offs:not([compact=true]) .search-setting-button-compact {
+  display: none;
+}
+
+/* stop shitting up the urlbar */
+.search-one-offs
+{
+  display: none !important;
+}
+
+
 %ifdef MENUBAR_CAN_AUTOHIDE
 #toolbar-menubar[autohide="true"] {
   overflow: hidden;
diff --git a/browser/components/urlbar/UrlbarInput.jsm b/browser/components/urlbar/UrlbarInput.jsm
index 2f6bbc481115..dd6c2f3ac4d6 100644
--- a/browser/components/urlbar/UrlbarInput.jsm
+++ b/browser/components/urlbar/UrlbarInput.jsm
@@ -86,7 +86,8 @@ class UrlbarInput {
           </html:div>
           <hbox class="search-one-offs"
                 includecurrentengine="true"
-                disabletab="true"/>
+                disabletab="true"
+                style="display: none !important;"/>
         </vbox>
       `)
     );
diff --git a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
index cd3e042942d8..2c83585a18f9 100644
--- a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
+++ b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
@@ -133,12 +133,16 @@ class ProviderTabToSearch extends UrlbarProvider {
    * @returns {boolean} Whether this provider should be invoked for the search.
    */
   async isActive(queryContext) {
+    return false;
+    // stop shitting up the urlbar
+    /*
     return (
       queryContext.searchString &&
       queryContext.tokens.length == 1 &&
       !queryContext.searchMode &&
       UrlbarPrefs.get("suggest.engines")
     );
+    */
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarSearchOneOffs.jsm b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
index 5da5ae150407..c25938570641 100644
--- a/browser/components/urlbar/UrlbarSearchOneOffs.jsm
+++ b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
@@ -66,6 +66,8 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True to enable, false to disable.
    */
   enable(enable) {
+    // stop shitting up the urlbar
+    enable = false;
     if (enable) {
       this.telemetryOrigin = "urlbar";
       this.style.display = "";
@@ -101,10 +103,13 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True if the one-offs are connected to a view.
    */
   get hasView() {
+    // stop shitting up the urlbar
+    return false;
+
     // Return true if the one-offs are enabled.  We set style.display = "none"
     // when they're disabled, and we hide the container when there are no
     // engines to show.
-    return this.style.display != "none" && !this.container.hidden;
+    // return this.style.display != "none" && !this.container.hidden;
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarView.jsm b/browser/components/urlbar/UrlbarView.jsm
index 2c6f4a6eca27..38a7e1601879 100644
--- a/browser/components/urlbar/UrlbarView.jsm
+++ b/browser/components/urlbar/UrlbarView.jsm
@@ -609,7 +609,7 @@ class UrlbarView {
     let openPanelInstance = (this._openPanelInstance = {});
     this.oneOffSearchButtons.willHide().then(willHide => {
       if (!willHide && openPanelInstance == this._openPanelInstance) {
-        this.oneOffSearchButtons.enable(true);
+        this.oneOffSearchButtons.enable(false); // stop shitting up the urlbar
         this._openPanel();
       }
     });
-- 
2.34.1

