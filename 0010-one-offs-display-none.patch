From f713d4c73b31ab2cb2acef56b8492d1ad4f81db7 Mon Sep 17 00:00:00 2001
From: Meriipu <Meriipu@users.noreply.github.com>
Date: Fri, 17 Dec 2021 16:09:47 +0100
Subject: [PATCH 10/10] one-offs: display: none

---
 browser/base/content/browser.css                      | 11 +++++++++++
 browser/components/urlbar/UrlbarInput.jsm             |  3 ++-
 .../components/urlbar/UrlbarProviderTabToSearch.jsm   |  4 ++++
 browser/components/urlbar/UrlbarSearchOneOffs.jsm     |  7 ++++++-
 browser/components/urlbar/UrlbarView.jsm              |  2 +-
 5 files changed, 24 insertions(+), 3 deletions(-)

diff --git a/browser/base/content/browser.css b/browser/base/content/browser.css
index 24013f36b4e7..91f419a9f511 100644
--- a/browser/base/content/browser.css
+++ b/browser/base/content/browser.css
@@ -98,6 +98,17 @@ body {
   -moz-window-dragging: drag;
 }
 
+.search-one-offs[compact=true] .search-setting-button,
+.search-one-offs:not([compact=true]) .search-setting-button-compact {
+  display: none;
+}
+
+/* stop shitting up the urlbar */
+.search-one-offs
+{
+  display: none !important;
+}
+
 #toolbar-menubar[autohide="true"] {
   overflow: hidden;
 }
diff --git a/browser/components/urlbar/UrlbarInput.jsm b/browser/components/urlbar/UrlbarInput.jsm
index b0ae70e859b1..ba15084d9eab 100644
--- a/browser/components/urlbar/UrlbarInput.jsm
+++ b/browser/components/urlbar/UrlbarInput.jsm
@@ -86,7 +86,8 @@ class UrlbarInput {
           </html:div>
           <hbox class="search-one-offs"
                 includecurrentengine="true"
-                disabletab="true"/>
+                disabletab="true"
+                style="display: none !important;"/>
         </vbox>
       `)
     );
diff --git a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
index 8b4e26d57dd6..8354555cd646 100644
--- a/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
+++ b/browser/components/urlbar/UrlbarProviderTabToSearch.jsm
@@ -133,12 +133,16 @@ class ProviderTabToSearch extends UrlbarProvider {
    * @returns {boolean} Whether this provider should be invoked for the search.
    */
   async isActive(queryContext) {
+    return false;
+    // stop shitting up the urlbar
+    /*
     return (
       queryContext.searchString &&
       queryContext.tokens.length == 1 &&
       !queryContext.searchMode &&
       UrlbarPrefs.get("suggest.engines")
     );
+    */
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarSearchOneOffs.jsm b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
index 6eb547ece841..59f55ff68376 100644
--- a/browser/components/urlbar/UrlbarSearchOneOffs.jsm
+++ b/browser/components/urlbar/UrlbarSearchOneOffs.jsm
@@ -66,6 +66,8 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True to enable, false to disable.
    */
   enable(enable) {
+    // stop shitting up the urlbar
+    enable = false;
     if (enable) {
       this.telemetryOrigin = "urlbar";
       this.style.display = "";
@@ -101,10 +103,13 @@ class UrlbarSearchOneOffs extends SearchOneOffs {
    *   True if the one-offs are connected to a view.
    */
   get hasView() {
+    // stop shitting up the urlbar
+    return false;
+
     // Return true if the one-offs are enabled.  We set style.display = "none"
     // when they're disabled, and we hide the container when there are no
     // engines to show.
-    return this.style.display != "none" && !this.container.hidden;
+    // return this.style.display != "none" && !this.container.hidden;
   }
 
   /**
diff --git a/browser/components/urlbar/UrlbarView.jsm b/browser/components/urlbar/UrlbarView.jsm
index e55937ce372e..c784b42f1260 100644
--- a/browser/components/urlbar/UrlbarView.jsm
+++ b/browser/components/urlbar/UrlbarView.jsm
@@ -623,7 +623,7 @@ class UrlbarView {
     let openPanelInstance = (this._openPanelInstance = {});
     this.oneOffSearchButtons.willHide().then(willHide => {
       if (!willHide && openPanelInstance == this._openPanelInstance) {
-        this.oneOffSearchButtons.enable(true);
+        this.oneOffSearchButtons.enable(false); // stop shitting up the urlbar
         this._openPanel();
       }
     });
-- 
2.38.0

